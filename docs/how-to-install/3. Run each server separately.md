# Server Setup and Execution Guide

This guide explains how to run the servers locally using Spring Boot.

## Prerequisites

- Java and Maven installed
- A running PostgreSQL v.15.4 database for FHIR Server with database name ```postgres```
- A running PostgreSQL v.17 database for ID Server with database name ```postgres```

If you didn't have any database setup yet, you can run a quick Postgres database with Docker image. Instruction is in folder `database-quickstart`

## Import ID Server' pre-configurated database

We must manually import it to database before running. The import file is in `run-all/import/id-backup.sql`

If you're running your Postgres database in a Docker container, you can follow the instruction in file `docs/how-to-install/2. Run all services....md`

If you're running your Postgres database in a separate service, you can use `pgAdmin` or `psql` to restore your database

## Configuration

Before running the servers, we need to configurate connection from:
- **Servers to Databases**
- **FHIR Server to ID Server**

By default, my servers will be running on:
- FHIR Server: `localhost:8090`
- ID Server: `localhost:8080`
- FHIR Database: `localhost:5432`
- ID Database: `localhost:5433`

### Configurate FHIR Server variables
Go to `cd fhir-server`, create a `.env` file and configurate these variables. For example with my database:

```
# Database config
FHIR_DB_HOST=localhost:5432
FHIR_DB_USERNAME=admin_fhir
FHIR_DB_PASSWORD=your_secure_password
# Connect to ID Server
ID_SERVER_URL=http://localhost:8080
```

If you want to run FHIR Server separately and not connecting to ID Server yet, add this variable:
```
SECURITY_ENABLED=false
```

### Configurate ID Server variables
Go to ```cd id-server```, create a ```.env``` file and configurate these variables. For example with my database:

```
DB_NAME=postgres
DB_HOST=localhost:5433
DB_USERNAME=admin_keycloak
DB_PASSWORD=your_secure_password
```

## Running Servers Locally

### Run FHIR Server

Navigate to the FHIR server directory and start with Maven:

```
cd fhir-server
mvn spring-boot:run
```

### Run ID Server

Navigate to the ID server directory and start with Keycloak server launch script:

```bash
# Run this in bash
cd id-server
./bin/kc.sh start-dev
```

## Notes

- Servers run in development mode when using `mvn spring-boot:run`
- **Ensure configuration variables are properly set** before starting
- If FHIR Server's `SECURITY_ENABLED=true`, both servers need to be running for full functionality