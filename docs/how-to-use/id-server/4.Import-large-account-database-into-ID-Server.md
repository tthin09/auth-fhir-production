# Import Large Account Database into ID Server

## Overview

Use Keycloak Admin API to bulk import user accounts into the ID Server. All account data must be formatted to match Keycloak's user representation structure.

Reference to Keycloak Admin API documentation for importing user:
https://www.keycloak.org/docs-api/latest/rest-api/index.html#_post_adminrealmsrealmusers

## Import Process

### Step 1: Prepare User Data in JSON Format

Format all account information to match Keycloak's [User Representation](https://www.keycloak.org/docs-api/latest/rest-api/index.html#UserRepresentation):

```
{
  "users": [
    {
      "username": "john.doe",
      "email": "john.doe@example.com",
      "firstName": "John",
      "lastName": "Doe",
      "enabled": true,
      "emailVerified": true,
      "attributes": {
        "department": ["cardiology"],
        "employee_id": ["EMP001"],
        "phone": ["+1234567890"]
      },
      "credentials": [
        {
          "type": "password",
          "value": "temporary_password",
          "temporary": true
        }
      ]
    },
    {
      ...
    }
  ]
}
```

### Step 2: Configure Custom Attributes

On Keycloak default user's profile, they only have some simple attribute like 'firstName', 'lastName'. For attributes at isn't in Keycloak standard fields, we can manually add them:
1. Access Keycloak Admin Console
2. Navigate to Realm Settings > User Profile
3. Use Create Attribute button to add custom attributes (department, employee_id, phone, etc.)
4. Configure attribute permissions and validation

### Step 3: Bulk Import via Admin API

To use Admin API, we have to get Admin's Access Token first using the Admin account `username` and `password`

```
# Get admin access token
POST /auth/admin/realms/master/protocol/openid-connect/token
Content-Type: application/x-www-form-urlencoded

grant_type=password
&client_id=admin-cli
&username=ADMIN_USERNAME
&password=ADMIN_PASSWORD


# Import users
POST /auth/admin/realms/fhir-realm/users
Authorization: Bearer ADMIN_ACCESS_TOKEN
Content-Type: application/json

{User JSON array from Step 1}
```

### Step 4: Batch Processing for Large Datasets

For very large datasets, process in batches:
- Import 100-500 users per batch
- Add delay between batches to avoid rate limiting
- Monitor import progress and handle errors

## Note

- Validate JSON format before import
- Any additional fields must be configured as custom attributes in Keycloak User Profile before import.
- Test with small batch first
- Monitor Keycloak logs during import process
- Backup existing user data